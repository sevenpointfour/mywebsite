 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Login Options - Your Health Hub</title>
     <!-- 1. Add CKEditor 5 script from CDN -->
     <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
     <link rel="stylesheet" href="main_style.css">
 </head>
 <body>
     <div id="navbar-placeholder"></div>
 
     <main>
         <!-- The page-title-section has been removed -->
          <ul>
               <li><a href="http://localhost:3020/client-login.html">Client Login</a></li>
               <li><a href="http://localhost:3020/staff-login.html">Staff Login</a></li>
              <li><a href="http://localhost:3020/admin-login.html">Admin Login</a></li>
              <li><a href="http://localhost:3000/login">Trainee Login</a></li>
              <li><a href="http://localhost:3000/admin/login">Training Admin Login</a></li>
        </ul>
         <!-- 2. Create a div that CKEditor will replace -->
         <div id="editor">
             <section class="content-section" style="padding-top: 20px;"> <!-- Added some top padding to content-section -->
                 <p>Welcome! Please choose an option below to access your personalized health resources or to begin your journey with us.</p>
                 
                 <div class="login-options-grid" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                     <div class="login-option-item card-blue">
                         <h3>Client Portal Login</h3>
                         <p>Access your personalized health plans, track your progress, and communicate with your consultant.</p>
                         <a href="http://localhost:3020/client-login.html" class="cta-button">Login to Client Portal</a>
                     </div>
 
                     <div class="login-option-item card-green">
                         <h3>Course Platform Login</h3>
                         <p>Access your enrolled online courses, learning materials, and community forums.</p>
                         <a href="http://localhost:3000/login" class="cta-button">Login to Courses</a>
                     </div>
                     
                     <div class="login-option-item card-yellow">
                         <h3>New User Registration</h3>
                         <p>Not yet a member? Register here to get started with our services or courses.</p>
                         <a href="http://localhost:3020/register.html" class="cta-button">Register Now</a>
                     </div>
                 </div>
                 <p style="margin-top: 30px;">If you have any trouble logging in or registering, please <a href="contact.html">contact us</a> for assistance.</p>
             </section>
         </div>
         <!-- 4. Add a Save button -->
         <button id="saveButton" class="cta-button" style="margin-top: 20px; margin-left: 20px;">Save Content</button>
     </main>
 
     <footer>
         <p>&copy; 2024 Your Name/Brand. All rights reserved.</p>
     </footer>
 
     <script src="load-navbar.js"></script>
     <!-- 3. Initialize CKEditor and add saving/loading logic -->
     <script>
         // Derive pageNameForContent from the HTML filename
         let pageNameForContent = window.location.pathname.split("/").pop() || "index.html";
         if (pageNameForContent.endsWith('.html')) {
             pageNameForContent = pageNameForContent.slice(0, -5);
         }
         // Special case for index.html, ensure pageNameForContent is "index"
         if (pageNameForContent === "" || pageNameForContent === "index.html") {
             pageNameForContent = "index";
         }
 
         let editorInstance; // To hold the CKEditor instance
         const adminToken = localStorage.getItem('adminWebsiteToken'); // Use a specific key for this site's admin
         const saveButton = document.getElementById('saveButton');
         let editorConfig = {}; // CKEditor configuration object
 
         if (adminToken) {
             saveButton.style.display = 'block'; // Or 'inline-block' or '' based on original CSS
             console.log('Admin token found. Save button enabled.');
         } else {
             saveButton.style.display = 'none';
             editorConfig.isReadOnly = true; // Make CKEditor read-only for non-admins
             console.log('No admin token. Save button hidden. Editor will be read-only.');
         }
 
         // Function to load content into the editor
         function loadEditorContent() {
             fetch(`/api/page-content/${pageNameForContent}`)
                 .then(response => response.json())
                 .then(data => {
                     if (editorInstance && data.content) {
                         editorInstance.setData(data.content);
                         console.log(`Content loaded into editor for ${pageNameForContent}.`);
                     } else if (editorInstance) {
                         console.log(`No saved content found for ${pageNameForContent}, or editor not ready for initial data. Using HTML content.`);
                     }
                 })
                 .catch(error => console.error('Error fetching content:', error));
         }
 
         ClassicEditor
             .create( document.querySelector( '#editor' ), editorConfig ) // Pass the config
             .then( newEditor => {
                 editorInstance = newEditor; // Store the editor instance
                 loadEditorContent(); // Load content after editor is initialized
                 if (editorConfig.isReadOnly) {
                    console.log(`CKEditor for ${pageNameForContent} configured as read-only.`);
                    if (newEditor.ui && newEditor.ui.element) {
                        newEditor.ui.element.classList.add('ck-editor-readonly-wrapper');
                        console.log(`Applied .ck-editor-readonly-wrapper to ${pageNameForContent}`);
                     }
                 } else {
                    console.log(`CKEditor initialized successfully for ${pageNameForContent}.`);
                    // Ensure the read-only class is not present if in admin mode
                    if (newEditor.ui && newEditor.ui.element) {
                        newEditor.ui.element.classList.remove('ck-editor-readonly-wrapper');
                     }
                 }
             } )
             .catch( error => {
                 console.error( `Error initializing CKEditor for ${pageNameForContent}:`, error );
             } );
 
         // Add event listener for the Save button only if admin
         if (adminToken) {
             saveButton.addEventListener('click', () => {
                 console.log('Save button clicked.');
                 if (editorInstance) {
                     console.log('Editor instance found.');
                     const data = editorInstance.getData();
                     console.log('Data from editor:', data);
 
                     // Re-fetch token in case it was set/cleared in another tab or by a login/logout action
                     const currentAdminToken = localStorage.getItem('adminWebsiteToken');
                     if (!currentAdminToken) {
                         alert('Admin session expired or token not found. Please log in again.');
                         saveButton.style.display = 'none'; // Hide button if token disappears
                         if (editorInstance && !editorInstance.isReadOnly) editorInstance.isReadOnly = true; // Make editor read-only
                         return;
                     }
 
                     fetch(`/api/page-content/${pageNameForContent}`, {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json',
                             'Authorization': `Bearer ${currentAdminToken}` // Send the token
                         },
                         body: JSON.stringify({ content: data }),
                     })
                     .then(response => {
                         console.log('Fetch response received:', response);
                         if (!response.ok) {
                             return response.json().catch(() => {
                                 throw new Error(`HTTP error! status: ${response.status} - ${response.statusText || 'Server error'}`);
                             }).then(errData => {
                                 throw new Error(`HTTP error! status: ${response.status} - ${errData.error || response.statusText || 'Server error'}`);
                             });
                         }
                         return response.json();
                     })
                     .then(result => {
                         console.log('Save result:', result);
                         alert(result.message || (result.error ? `Error: ${result.error}` : 'Save completed.'));
                     })
                     .catch(error => {
                         console.error('Error saving content:', error);
                         alert('Error saving content: ' + error.message);
                     });
                 } else {
                     console.log('Editor instance NOT found. CKEditor might not have initialized correctly.');
                     alert('Editor is not ready. Please wait a moment and try again, or check the console for errors during CKEditor initialization.');
                 }
             });
         }
     </script>
 </body>
 </html>
 
