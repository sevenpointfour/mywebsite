 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>About Us - Detailed - Your Health Hub</title>
     <!-- 1. Add CKEditor 5 script from CDN -->
     <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
     <link rel="stylesheet" href="main_style.css">
 </head>
 <body>
     <div id="navbar-placeholder"></div>
 
     <main>
         <section class="page-title-section">
             <h1>About Us - In Detail</h1>
         </section>
 
         <section class="content-section">
             <!-- 2. Create a div that CKEditor will replace -->
             <div id="editor">
                 <p>This is where you can elaborate on your mission, your brand's background, expertise, qualifications, and the journey that led you to offer these health and wellness services. You can talk about your philosophy and approach in more depth.</p>
                 <p>Content here will eventually be editable via a rich text editor from the backend.</p>
             </div>
             <!-- 4. Add a Save button -->
             <button id="saveButton" class="cta-button" style="margin-top: 20px;">Save Content</button>
         </section>
     </main>
 
     <footer>
         <p>&copy; 2024 Your Name/Brand. All rights reserved.</p>
     </footer>
 
     <script src="load-navbar.js"></script>
     <!-- 3. Initialize CKEditor -->
     <script>
        // Derive pageNameForContent from the HTML filename (e.g., "about-us-detail" from "about-us-detail.html")
        // Handles "index.html" or root path correctly.
        let pageNameForContent = window.location.pathname.split("/").pop() || "index.html";
        if (pageNameForContent.endsWith('.html')) {
            pageNameForContent = pageNameForContent.slice(0, -5);
        }

         let editorInstance; // To hold the CKEditor instance
 
        // Function to load content into the editor
        function loadEditorContent() {
            fetch(`/api/page-content/${pageNameForContent}`)
                .then(response => response.json())
                .then(data => {
                    if (editorInstance && data.content) {
                        editorInstance.setData(data.content);
                        console.log(`Content loaded into editor for ${pageNameForContent}.`);
                    } else if (editorInstance) {
                        console.log(`No saved content found for ${pageNameForContent}, or editor not ready for initial data. Using HTML content.`);
                    }
                })
                .catch(error => console.error('Error fetching content:', error));
        }

         ClassicEditor
             .create( document.querySelector( '#editor' ) )
             .then( newEditor => {
                 editorInstance = newEditor; // Store the editor instance
                loadEditorContent(); // Load content after editor is initialized
                 console.log(`CKEditor initialized successfully for ${pageNameForContent}.`);
             } )
             .catch( error => {
                 console.error( `Error initializing CKEditor for ${pageNameForContent}:`, error );
             } );
 
         // 5. Add event listener for the Save button
         document.getElementById('saveButton').addEventListener('click', () => {
             console.log('Save button clicked.'); // Debug: Log button click
             if (editorInstance) {
                 console.log('Editor instance found.'); // Debug: Log if editor instance exists
                 const data = editorInstance.getData(); // Get content from CKEditor
                console.log('Data from editor:', data); // Debug: Log the data from editor
 
                fetch(`/api/page-content/${pageNameForContent}`, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({ content: data }),
                 })
                 .then(response => {
                     console.log('Fetch response received:', response); // Debug: Log the raw response
                     if (!response.ok) {
                         // If response is not OK, try to parse error as JSON, or throw generic error
                         return response.json().catch(() => {
                             // If response.json() fails (e.g. not valid JSON), throw with statusText
                             throw new Error(`HTTP error! status: ${response.status} - ${response.statusText || 'Server error'}`);
                         }).then(errData => {
                             // If response.json() succeeds, use the error message from JSON
                             throw new Error(`HTTP error! status: ${response.status} - ${errData.error || response.statusText || 'Server error'}`);
                         });
                     }
                     return response.json();
                 })
                 .then(result => {
                     console.log('Save result:', result);
                     alert(result.message || (result.error ? `Error: ${result.error}` : 'Save completed.'));
                 })
                 .catch(error => {
                     console.error('Error saving content:', error);
                     alert('Error saving content: ' + error.message); // Show error in alert
                 });
             } else {
                 console.log('Editor instance NOT found. CKEditor might not have initialized correctly.'); // Debug: Log if editor instance is missing
                 alert('Editor is not ready. Please wait a moment and try again, or check the console for errors during CKEditor initialization.');
             }
         });
     </script>
 </body>
 </html>
 