 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Personalized Health Consultation - Your Health Hub</title>
     <!-- 1. Add CKEditor 5 script from CDN -->
     <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
     <link rel="stylesheet" href="main_style.css">
 </head>
 <body>
     <div id="navbar-placeholder"></div>
 
     <main>
         <section class="page-title-section">
             <h1>Personalized Health Consultation</h1>
         </section>
 
         <!-- 2. Create a div that CKEditor will replace -->
         <div id="editor">
             <section class="content-section">
                 <p>Detailed information about the Personalized Health Consultation service. Explain the process, benefits, what's included, and how to register or book an appointment.</p>
                 <p>This page will describe the in-depth one-on-one consultations, the creation of a tailored plan, and access to the client management portal for ongoing support and tracking.</p>
                
                 <div style="margin-top: 25px; padding: 15px; background-color: #e9ecef; border-radius: 5px; text-align: center;">
                    <h3>Access Our Consultation Portal</h3>
                    <p>For detailed scheduling, pre-consultation forms, and direct communication, please visit our dedicated portal.</p>
                    <a href="consultation_portal/index.html" class="cta-button">Go to Consultation Portal</a>
                 </div>
             </section>
         </div>
         <!-- 4. Add a Save button -->
         <button id="saveButton" class="cta-button" style="margin-top: 20px; margin-left: 20px;">Save Content</button>
     </main>
 
     <footer>
         <p>&copy; 2024 Your Name/Brand. All rights reserved.</p>
     </footer>
     <script src="load-navbar.js"></script>
     <!-- 3. Initialize CKEditor and add saving/loading logic -->
     <script>
         // Derive pageNameForContent from the HTML filename
         let pageNameForContent = window.location.pathname.split("/").pop() || "index.html";
         if (pageNameForContent.endsWith('.html')) {
             pageNameForContent = pageNameForContent.slice(0, -5);
         }
         // Special case for index.html, ensure pageNameForContent is "index"
         if (pageNameForContent === "" || pageNameForContent === "index.html") {
             pageNameForContent = "index";
         }
 
         let editorInstance; // To hold the CKEditor instance
 
         // Function to load content into the editor
         function loadEditorContent() {
             fetch(`/api/page-content/${pageNameForContent}`)
                 .then(response => response.json())
                 .then(data => {
                     if (editorInstance && data.content) {
                         editorInstance.setData(data.content);
                         console.log(`Content loaded into editor for ${pageNameForContent}.`);
                     } else if (editorInstance) {
                         console.log(`No saved content found for ${pageNameForContent}, or editor not ready for initial data. Using HTML content.`);
                     }
                 })
                 .catch(error => console.error('Error fetching content:', error));
         }
 
         ClassicEditor
             .create( document.querySelector( '#editor' ) )
             .then( newEditor => {
                 editorInstance = newEditor; // Store the editor instance
                 loadEditorContent(); // Load content after editor is initialized
                 console.log(`CKEditor initialized successfully for ${pageNameForContent}.`);
             } )
             .catch( error => {
                 console.error( `Error initializing CKEditor for ${pageNameForContent}:`, error );
             } );
 
         // Add event listener for the Save button
         document.getElementById('saveButton').addEventListener('click', () => {
             console.log('Save button clicked.');
             if (editorInstance) {
                 console.log('Editor instance found.');
                 const data = editorInstance.getData();
                 console.log('Data from editor:', data);
 
                 fetch(`/api/page-content/${pageNameForContent}`, {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({ content: data }),
                 })
                 .then(response => response.json()) 
                 .then(result => {
                     console.log('Save result:', result);
                     alert(result.message || (result.error ? `Error: ${result.error}` : 'Save completed.'));
                 })
                 .catch(error => {
                     console.error('Error saving content:', error);
                     alert('Error saving content: ' + error.message);
                 });
             } else {
                 console.log('Editor instance NOT found. CKEditor might not have initialized correctly.');
                 alert('Editor is not ready. Please wait a moment and try again, or check the console for errors during CKEditor initialization.');
             }
         });
     </script>
 </body>
 </html>
 