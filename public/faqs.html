<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQs - Your Health Hub</title>
    <!-- 1. Add TinyMCE script from CDN (replace API key if needed) -->
    <script src="https://cdn.tiny.cloud/1/s7g5cgt18q6g9dw7ud0p9tksgllbcoyz3bb071o39s55c7ac/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
    <link rel="stylesheet" href="main_style.css">
</head>
<body>
    <div id="navbar-placeholder"></div>

    <main>
        <section class="page-title-section">
            <h1>Frequently Asked Questions</h1>
        </section>

        <!-- 2. Use a textarea for TinyMCE -->
        <textarea id="editor" style="min-height: 300px;">
            <section class="content-section">
                <p>Find answers to common questions about our services, programs, and approach to health and wellness.</p>

                <div class="faq-list">
                    <div class="faq-item">
                        <h3>What kind of services do you offer?</h3>
                        <p>We offer a range of services including personalized health consultations, specialized detox and wellness programs, health awareness courses, and more. Please visit our <a href="services.html">Services page</a> for detailed information.</p>
                    </div>

                    <div class="faq-item">
                        <h3>How can I book a consultation?</h3>
                        <p>You can book a consultation by visiting our <a href="consultation-info.html">Personalized Health Consultation page</a> and following the registration instructions, or by <a href="contact.html">contacting us</a> directly.</p>
                    </div>

                    <div class="faq-item">
                        <h3>Are your programs available online?</h3>
                        <p>Yes, many of our courses and programs, such as the Health Awareness Course and Dhanwantari Yog Training, are available in both online and offline formats. Please check the specific service page for details.</p>
                    </div>
                    <!-- Add more FAQ items here -->
                </div>
            </section>
        </textarea>
        <!-- 4. Add a Save button -->
        <button id="saveButton" class="cta-button" style="margin-top: 20px; margin-left: 20px;">Save Content</button>
        <div id="status" style="margin-top: 1rem; font-style: italic; color: #555;"></div>
    </main>

    <footer>
        <p>&copy; 2024 Your Name/Brand. All rights reserved.</p>
    </footer>

    <script src="load-navbar.js"></script>
    <!-- 3. Initialize TinyMCE and add saving/loading logic -->
    <script>
        // Derive pageNameForContent from the HTML filename
        let pageNameForContent = window.location.pathname.split("/").pop() || "index.html";
        if (pageNameForContent.endsWith('.html')) {
            pageNameForContent = pageNameForContent.slice(0, -5);
        }
        if (pageNameForContent === "" || pageNameForContent === "index.html") {
            pageNameForContent = "index";
        }

        const adminToken = localStorage.getItem('adminWebsiteToken');
        const saveButton = document.getElementById('saveButton');
        const statusDiv = document.getElementById('status');
        const isReadOnly = !adminToken;

        if (isReadOnly) {
            saveButton.style.display = 'none';
        } else {
            saveButton.style.display = 'block';
        }

        tinymce.init({
            selector: 'textarea#editor',
            readonly: isReadOnly,
            plugins: 'code table lists image link media wordcount help',
            toolbar: isReadOnly ? false : 'undo redo | blocks | bold italic | alignleft aligncenter alignright | indent outdent | bullist numlist | code | table | image link media | help',
            menubar: !isReadOnly,
            height: 500,
            setup: function(editor) {
                editor.on('init', function() {
                    loadContent();
                });
            }
        });

        async function loadContent() {
            statusDiv.textContent = `Loading content for '${pageNameForContent}'...`;
            try {
                const response = await fetch(`/api/page-content/${pageNameForContent}`);
                if (!response.ok) throw new Error(`Failed to load content. Status: ${response.status}`);
                const data = await response.json();
                if (data && data.content) {
                    tinymce.get('editor').setContent(data.content);
                }
                statusDiv.textContent = `Content for '${pageNameForContent}' loaded.`;
            } catch (error) {
                console.error('Error loading content:', error);
                statusDiv.textContent = `Error: ${error.message}`;
            }
        }

        if (!isReadOnly) {
            saveButton.addEventListener('click', async () => {
                const content = tinymce.get('editor').getContent();
                const token = localStorage.getItem('adminWebsiteToken');
                if (!token) {
                    alert('You must be logged in to save content.');
                    statusDiv.textContent = 'Error: Not logged in.';
                    return;
                }
                statusDiv.textContent = `Saving content for '${pageNameForContent}'...`;
                try {
                    const response = await fetch(`/api/page-content/${pageNameForContent}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ content: content })
                    });
                    const result = await response.json();
                    if (response.ok) {
                        statusDiv.textContent = result.message || 'Content saved successfully!';
                        alert('Content saved successfully!');
                    } else {
                        throw new Error(result.error || 'An unknown error occurred.');
                    }
                } catch (error) {
                    console.error('Error saving content:', error);
                    statusDiv.textContent = `Error saving content: ${error.message}`;
                    alert(`Error saving content: ${error.message}`);
                }
            });
        }
    </script>